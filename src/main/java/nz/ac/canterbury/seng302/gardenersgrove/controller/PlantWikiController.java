package nz.ac.canterbury.seng302.gardenersgrove.controller;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import nz.ac.canterbury.seng302.gardenersgrove.service.SecurityService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.net.URI;
import java.net.URLEncoder;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.util.List;


/**
 * Controller for plant info endpoints
 */
@Controller
public class PlantWikiController {
    Logger logger = LoggerFactory.getLogger(PlantWikiController.class);
    private final SecurityService securityService;

    @Value("${perenual.plant.api.key}")
    private String perenualPlantAPIKey;


    @Autowired
    public PlantWikiController(SecurityService securityService) {
        this.securityService = securityService;
    }


    public JsonNode getPlantListJson(String query) throws IOException, InterruptedException {

        String examplePlantListString = "{\"data\":[{\"id\":183,\"common_name\":\"Strawberry Tree\",\"scientific_name\":[\"Arbutus unedo\"],\"other_name\":[\"Apple of Cain; Cane Apple\"],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\",\"part sun/part shade\",\"sheltered\"],\"default_image\":{\"license\":6,\"license_name\":\"Attribution-NoDerivs License\",\"license_url\":\"https://creativecommons.org/licenses/by-nd/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/183_arbutus_unedo/og/50433219232_449b440340_b.jpg\"}},{\"id\":184,\"common_name\":\"Common Paw Paw\",\"scientific_name\":[\"Asimina triloba\"],\"other_name\":[\"Pawpaw Apple\",\"False-Banana\",\"Poor Man's Banana\",\"Pawpaw\",\"False Banana\",\"Pawpaw Custardapple\"],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\",\"part sun/part shade\"],\"default_image\":{\"license\":5,\"license_name\":\"Attribution-ShareAlike License\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/184_asimina_triloba/og/36488336082_9d0132fcd0_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/184_asimina_triloba/regular/36488336082_9d0132fcd0_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/184_asimina_triloba/medium/36488336082_9d0132fcd0_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/184_asimina_triloba/small/36488336082_9d0132fcd0_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/184_asimina_triloba/thumbnail/36488336082_9d0132fcd0_b.jpg\"}},{\"id\":351,\"common_name\":\"Akane Apple\",\"scientific_name\":[\"Malus 'Akane'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/351_malus_akane/og/800px-Akane-Pomme-20141026.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/351_malus_akane/regular/800px-Akane-Pomme-20141026.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/351_malus_akane/medium/800px-Akane-Pomme-20141026.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/351_malus_akane/small/800px-Akane-Pomme-20141026.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/351_malus_akane/thumbnail/800px-Akane-Pomme-20141026.jpg\"}},{\"id\":352,\"common_name\":\"Ambrosia Apple\",\"scientific_name\":[\"Malus 'Ambrosia'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/352_malus_ambrosia/og/30356393327_b96daa22cb_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/352_malus_ambrosia/regular/30356393327_b96daa22cb_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/352_malus_ambrosia/medium/30356393327_b96daa22cb_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/352_malus_ambrosia/small/30356393327_b96daa22cb_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/352_malus_ambrosia/thumbnail/30356393327_b96daa22cb_b.jpg\"}},{\"id\":353,\"common_name\":\"Belle de Boskoop Apple\",\"scientific_name\":[\"Malus 'Belle de Boskoop'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/353_malus_belle_de_boskoop/og/337214c7b72a8b61ca79685f9ebe-1633146.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/353_malus_belle_de_boskoop/regular/337214c7b72a8b61ca79685f9ebe-1633146.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/353_malus_belle_de_boskoop/medium/337214c7b72a8b61ca79685f9ebe-1633146.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/353_malus_belle_de_boskoop/small/337214c7b72a8b61ca79685f9ebe-1633146.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/353_malus_belle_de_boskoop/thumbnail/337214c7b72a8b61ca79685f9ebe-1633146.jpg\"}},{\"id\":354,\"common_name\":\"Braeburn Apple\",\"scientific_name\":[\"Malus 'Braeburn'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\",\"filtered shade\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/354_malus_braeburn/og/26257641106_44b6973b16_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/354_malus_braeburn/regular/26257641106_44b6973b16_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/354_malus_braeburn/medium/26257641106_44b6973b16_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/354_malus_braeburn/small/26257641106_44b6973b16_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/354_malus_braeburn/thumbnail/26257641106_44b6973b16_b.jpg\"}},{\"id\":355,\"common_name\":\"Candied Apple Flowering Crab\",\"scientific_name\":[\"Malus 'Candied Apple'\"],\"other_name\":[\"Roseybloom\",\"Crabapple\"],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\",\"part shade\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/355_malus_candied_apple/og/663px-Apples_on_tree_2021_G1.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/355_malus_candied_apple/regular/663px-Apples_on_tree_2021_G1.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/355_malus_candied_apple/medium/663px-Apples_on_tree_2021_G1.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/355_malus_candied_apple/small/663px-Apples_on_tree_2021_G1.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/355_malus_candied_apple/thumbnail/663px-Apples_on_tree_2021_G1.jpg\"}},{\"id\":356,\"common_name\":\"Chehalis Apple\",\"scientific_name\":[\"Malus 'Chehalis'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/356_malus_chehalis/og/apple_garden_apfelernte_green_red_apple_tree_autumn_pick_food-689389.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/356_malus_chehalis/regular/apple_garden_apfelernte_green_red_apple_tree_autumn_pick_food-689389.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/356_malus_chehalis/medium/apple_garden_apfelernte_green_red_apple_tree_autumn_pick_food-689389.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/356_malus_chehalis/small/apple_garden_apfelernte_green_red_apple_tree_autumn_pick_food-689389.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/356_malus_chehalis/thumbnail/apple_garden_apfelernte_green_red_apple_tree_autumn_pick_food-689389.jpg\"}},{\"id\":357,\"common_name\":\"Cortland Apple\",\"scientific_name\":[\"Malus 'Cortland'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/357_malus_cortland/og/Talvenauding.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/357_malus_cortland/regular/Talvenauding.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/357_malus_cortland/medium/Talvenauding.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/357_malus_cortland/small/Talvenauding.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/357_malus_cortland/thumbnail/Talvenauding.jpg\"}},{\"id\":358,\"common_name\":\"Cox's Orange Pippin Apple\",\"scientific_name\":[\"Malus 'Cox's Orange Pippin'\"],\"other_name\":[\"Cox Orange\"],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/358_malus_coxs_orange_pippin/og/Cox_orange_renette2.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/358_malus_coxs_orange_pippin/regular/Cox_orange_renette2.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/358_malus_coxs_orange_pippin/medium/Cox_orange_renette2.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/358_malus_coxs_orange_pippin/small/Cox_orange_renette2.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/358_malus_coxs_orange_pippin/thumbnail/Cox_orange_renette2.jpg\"}},{\"id\":359,\"common_name\":\"Dolgo Apple\",\"scientific_name\":[\"Malus 'Dolgo'\"],\"other_name\":[\"Roseybloom\",\"Crabapple\"],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/359_malus_dolgo/og/apple-zieraepfel-wild-apple-tree-branch.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/359_malus_dolgo/regular/apple-zieraepfel-wild-apple-tree-branch.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/359_malus_dolgo/medium/apple-zieraepfel-wild-apple-tree-branch.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/359_malus_dolgo/small/apple-zieraepfel-wild-apple-tree-branch.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/359_malus_dolgo/thumbnail/apple-zieraepfel-wild-apple-tree-branch.jpg\"}},{\"id\":360,\"common_name\":\"Donald Wyman Flowering Crab\",\"scientific_name\":[\"Malus 'Donald Wyman'\"],\"other_name\":[\"Roseybloom\",\"Crabapple\"],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/360_malus_donald_wyman/og/frembellishment_apple_small_694055-image-kybdt6db.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/360_malus_donald_wyman/regular/frembellishment_apple_small_694055-image-kybdt6db.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/360_malus_donald_wyman/medium/frembellishment_apple_small_694055-image-kybdt6db.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/360_malus_donald_wyman/small/frembellishment_apple_small_694055-image-kybdt6db.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/360_malus_donald_wyman/thumbnail/frembellishment_apple_small_694055-image-kybdt6db.jpg\"}},{\"id\":361,\"common_name\":\"Elstar Apple\",\"scientific_name\":[\"Malus 'Elstar'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/361_malus_elstar/og/garden-apple-tree-fruit-harvest.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/361_malus_elstar/regular/garden-apple-tree-fruit-harvest.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/361_malus_elstar/medium/garden-apple-tree-fruit-harvest.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/361_malus_elstar/small/garden-apple-tree-fruit-harvest.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/361_malus_elstar/thumbnail/garden-apple-tree-fruit-harvest.jpg\"}},{\"id\":362,\"common_name\":\"Gala Apple\",\"scientific_name\":[\"Malus 'Gala'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/362_malus_gala/og/50860295937_612a404fc9_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/362_malus_gala/regular/50860295937_612a404fc9_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/362_malus_gala/medium/50860295937_612a404fc9_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/362_malus_gala/small/50860295937_612a404fc9_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/362_malus_gala/thumbnail/50860295937_612a404fc9_b.jpg\"}},{\"id\":363,\"common_name\":\"Golden Delicious Apple\",\"scientific_name\":[\"Malus 'Golden Delicious'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\",\"part shade\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/363_malus_golden_delicious/og/49974806732_27600746d1_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/363_malus_golden_delicious/regular/49974806732_27600746d1_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/363_malus_golden_delicious/medium/49974806732_27600746d1_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/363_malus_golden_delicious/small/49974806732_27600746d1_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/363_malus_golden_delicious/thumbnail/49974806732_27600746d1_b.jpg\"}},{\"id\":364,\"common_name\":\"Golden Russet Apple\",\"scientific_name\":[\"Malus 'Golden Russet'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/364_malus_golden_russet/og/Malus_sylvestris_005.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/364_malus_golden_russet/regular/Malus_sylvestris_005.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/364_malus_golden_russet/medium/Malus_sylvestris_005.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/364_malus_golden_russet/small/Malus_sylvestris_005.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/364_malus_golden_russet/thumbnail/Malus_sylvestris_005.jpg\"}},{\"id\":365,\"common_name\":\"Granny Smith Apple\",\"scientific_name\":[\"Malus 'Granny Smith'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/365_malus_granny_smith/og/52433732205_15e7af9d98_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/365_malus_granny_smith/regular/52433732205_15e7af9d98_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/365_malus_granny_smith/medium/52433732205_15e7af9d98_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/365_malus_granny_smith/small/52433732205_15e7af9d98_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/365_malus_granny_smith/thumbnail/52433732205_15e7af9d98_b.jpg\"}},{\"id\":366,\"common_name\":\"Gravenstein Apple\",\"scientific_name\":[\"Malus 'Gravenstein'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\",\"part sun/part shade\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/366_malus_gravenstein/og/Malus-Shampion.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/366_malus_gravenstein/regular/Malus-Shampion.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/366_malus_gravenstein/medium/Malus-Shampion.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/366_malus_gravenstein/small/Malus-Shampion.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/366_malus_gravenstein/thumbnail/Malus-Shampion.jpg\"}},{\"id\":367,\"common_name\":\"Honeycrisp Apple\",\"scientific_name\":[\"Malus 'Honeycrisp'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/367_malus_honeycrisp/og/SweeTango_apple_harvest_2010.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/367_malus_honeycrisp/regular/SweeTango_apple_harvest_2010.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/367_malus_honeycrisp/medium/SweeTango_apple_harvest_2010.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/367_malus_honeycrisp/small/SweeTango_apple_harvest_2010.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/367_malus_honeycrisp/thumbnail/SweeTango_apple_harvest_2010.jpg\"}},{\"id\":368,\"common_name\":\"Jonagold Apple\",\"scientific_name\":[\"Malus 'Jonagold'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/368_malus_jonagold/og/3968289043_ec00297a19_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/368_malus_jonagold/regular/3968289043_ec00297a19_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/368_malus_jonagold/medium/3968289043_ec00297a19_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/368_malus_jonagold/small/3968289043_ec00297a19_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/368_malus_jonagold/thumbnail/3968289043_ec00297a19_b.jpg\"}},{\"id\":369,\"common_name\":\"Jonathan Apple\",\"scientific_name\":[\"Malus 'Jonathan'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\",\"part shade\"],\"default_image\":{\"license\":5,\"license_name\":\"Attribution-ShareAlike License\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/369_malus_jonathan/og/3896656299_a4328986e4_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/369_malus_jonathan/regular/3896656299_a4328986e4_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/369_malus_jonathan/medium/3896656299_a4328986e4_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/369_malus_jonathan/small/3896656299_a4328986e4_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/369_malus_jonathan/thumbnail/3896656299_a4328986e4_b.jpg\"}},{\"id\":370,\"common_name\":\"Liberty Apple\",\"scientific_name\":[\"Malus 'Liberty'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\",\"part shade\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/370_malus_liberty/og/Malus-Berner-Rosenapfel_27.08.2012.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/370_malus_liberty/regular/Malus-Berner-Rosenapfel_27.08.2012.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/370_malus_liberty/medium/Malus-Berner-Rosenapfel_27.08.2012.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/370_malus_liberty/small/Malus-Berner-Rosenapfel_27.08.2012.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/370_malus_liberty/thumbnail/Malus-Berner-Rosenapfel_27.08.2012.jpg\"}},{\"id\":371,\"common_name\":\"Lodi Apple\",\"scientific_name\":[\"Malus 'Lodi'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/371_malus_lodi/og/2560px-PapierC3B3wka_owoce_na_gaC582C499ziach.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/371_malus_lodi/regular/2560px-PapierC3B3wka_owoce_na_gaC582C499ziach.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/371_malus_lodi/medium/2560px-PapierC3B3wka_owoce_na_gaC582C499ziach.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/371_malus_lodi/small/2560px-PapierC3B3wka_owoce_na_gaC582C499ziach.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/371_malus_lodi/thumbnail/2560px-PapierC3B3wka_owoce_na_gaC582C499ziach.jpg\"}},{\"id\":372,\"common_name\":\"Louisa Flowering Crab\",\"scientific_name\":[\"Malus 'Louisa'\"],\"other_name\":[\"Roseybloom\",\"Crabapple\"],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/372_malus_louisa/og/10362143644_d44b00de9e_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/372_malus_louisa/regular/10362143644_d44b00de9e_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/372_malus_louisa/medium/10362143644_d44b00de9e_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/372_malus_louisa/small/10362143644_d44b00de9e_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/372_malus_louisa/thumbnail/10362143644_d44b00de9e_b.jpg\"}},{\"id\":373,\"common_name\":\"Macintosh Apple\",\"scientific_name\":[\"Malus 'Macintosh'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\",\"part shade\"],\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\",\"original_url\":\"https://perenual.com/storage/species_image/373_malus_macintosh/og/515px-Malus_Nela.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/373_malus_macintosh/regular/515px-Malus_Nela.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/373_malus_macintosh/medium/515px-Malus_Nela.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/373_malus_macintosh/small/515px-Malus_Nela.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/373_malus_macintosh/thumbnail/515px-Malus_Nela.jpg\"}},{\"id\":374,\"common_name\":\"Melrose Apple\",\"scientific_name\":[\"Malus 'Melrose'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/374_malus_melrose/og/50860213661_1b84b33396_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/374_malus_melrose/regular/50860213661_1b84b33396_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/374_malus_melrose/medium/50860213661_1b84b33396_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/374_malus_melrose/small/50860213661_1b84b33396_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/374_malus_melrose/thumbnail/50860213661_1b84b33396_b.jpg\"}},{\"id\":375,\"common_name\":\"Norland Apple\",\"scientific_name\":[\"Malus 'Norland'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/375_malus_norland/og/frapple_apple_tree_fruit_17-image-kycidzch.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/375_malus_norland/regular/frapple_apple_tree_fruit_17-image-kycidzch.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/375_malus_norland/medium/frapple_apple_tree_fruit_17-image-kycidzch.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/375_malus_norland/small/frapple_apple_tree_fruit_17-image-kycidzch.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/375_malus_norland/thumbnail/frapple_apple_tree_fruit_17-image-kycidzch.jpg\"}},{\"id\":376,\"common_name\":\"Pink Lady Apple\",\"scientific_name\":[\"Malus 'Pink Lady'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\"],\"default_image\":{\"license\":4,\"license_name\":\"Attribution License\",\"license_url\":\"https://creativecommons.org/licenses/by/2.0/\",\"original_url\":\"https://perenual.com/storage/species_image/376_malus_pink_lady/og/25239912735_4801f32049_b.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/376_malus_pink_lady/regular/25239912735_4801f32049_b.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/376_malus_pink_lady/medium/25239912735_4801f32049_b.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/376_malus_pink_lady/small/25239912735_4801f32049_b.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/376_malus_pink_lady/thumbnail/25239912735_4801f32049_b.jpg\"}},{\"id\":378,\"common_name\":\"Red Delicious Apple\",\"scientific_name\":[\"Malus 'Red Delicious'\"],\"other_name\":[],\"cycle\":\"Perennial\",\"watering\":\"Frequent\",\"sunlight\":[\"full sun\",\"part shade\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/378_malus_red_delicious/og/culture_of_apple_apple_malus_domestica_autumn_ripe_harvest_fruit_nutrients-936179.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/378_malus_red_delicious/regular/culture_of_apple_apple_malus_domestica_autumn_ripe_harvest_fruit_nutrients-936179.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/378_malus_red_delicious/medium/culture_of_apple_apple_malus_domestica_autumn_ripe_harvest_fruit_nutrients-936179.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/378_malus_red_delicious/small/culture_of_apple_apple_malus_domestica_autumn_ripe_harvest_fruit_nutrients-936179.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/378_malus_red_delicious/thumbnail/culture_of_apple_apple_malus_domestica_autumn_ripe_harvest_fruit_nutrients-936179.jpg\"}},{\"id\":379,\"common_name\":\"Red Jewel Flowering Crab\",\"scientific_name\":[\"Malus 'Red Jewel'\"],\"other_name\":[\"Roseybloom\",\"Crabapple\"],\"cycle\":\"Perennial\",\"watering\":\"Average\",\"sunlight\":[\"full sun\",\"part shade\"],\"default_image\":{\"license\":451,\"license_name\":\"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication\",\"license_url\":\"https://creativecommons.org/publicdomain/zero/1.0/\",\"original_url\":\"https://perenual.com/storage/species_image/379_malus_red_jewel/og/embellishment_apple_small_ornamental_tree_ornamental_fruit_malus_rose_greenhouse_fruits-745555.jpg\",\"regular_url\":\"https://perenual.com/storage/species_image/379_malus_red_jewel/regular/embellishment_apple_small_ornamental_tree_ornamental_fruit_malus_rose_greenhouse_fruits-745555.jpg\",\"medium_url\":\"https://perenual.com/storage/species_image/379_malus_red_jewel/medium/embellishment_apple_small_ornamental_tree_ornamental_fruit_malus_rose_greenhouse_fruits-745555.jpg\",\"small_url\":\"https://perenual.com/storage/species_image/379_malus_red_jewel/small/embellishment_apple_small_ornamental_tree_ornamental_fruit_malus_rose_greenhouse_fruits-745555.jpg\",\"thumbnail\":\"https://perenual.com/storage/species_image/379_malus_red_jewel/thumbnail/embellishment_apple_small_ornamental_tree_ornamental_fruit_malus_rose_greenhouse_fruits-745555.jpg\"}}],\"to\":30,\"per_page\":30,\"current_page\":1,\"from\":1,\"last_page\":4,\"total\":102}";

        String encodedQuery = URLEncoder.encode(query, "UTF-8");

        HttpRequest request = HttpRequest.newBuilder()
                .uri(URI.create("https://perenual.com/api/species/details/?key=" + perenualPlantAPIKey + "&=" + encodedQuery
                ))
                .header("accept", "application/json")
                .method("GET", HttpRequest.BodyPublishers.noBody())
                .build();

        logger.info("Call to Perenual Plant API:" + request);
        HttpResponse<String> response = HttpClient.newHttpClient().send(request, HttpResponse.BodyHandlers.ofString());

        ObjectMapper mapper = new ObjectMapper();

//        JsonNode plantList = mapper.readTree(response.body());
        JsonNode plantList = mapper.readTree(examplePlantListString);

        return plantList;

    }

    /**
     * Gets the response body of the Perenual API plant details call.
     * @param plantId ID of plant species
     * @return plantInfo - a JsonNode containing the plant information such as common name, scientific name, image, etc.
     * @throws JsonProcessingException if the JSON string has an invalid format
     */
    public JsonNode getPlantDetailsJson(String plantId) throws IOException, InterruptedException {

        HttpRequest request = HttpRequest.newBuilder()
                .uri(URI.create("https://perenual.com/api/species/details/" + plantId + "?key=" + perenualPlantAPIKey
                ))
                .header("accept", "application/json")
                .method("GET", HttpRequest.BodyPublishers.noBody())
                .build();

        logger.info("Call to Perenual Plant API:" + request);
        HttpResponse<String> response = HttpClient.newHttpClient().send(request, HttpResponse.BodyHandlers.ofString());

        String examplePlantDataString = "{\"id\":1,\"common_name\":\"European Silver Fir\",\"scientific_name\":[\"Abies alba\"],\"other_name\":[\"Common Silver Fir\"],\"family\":null,\"origin\":[\"Austria\",\"Germany\",\"Switzerland\",\"France\",\"Italy\",\"Slovenia\",\"Croatia\",\"Bosnia and Herzegovina\",\"Serbia\",\"Montenegro\",\"Albania\",\"Bulgaria\",\"Romania\",\"Ukraine\",\"Poland\",\"Czech Republic\",\"Slovakia\",\"Hungary\"],\"type\":\"tree\",\"dimension\":\"Height:  60 feet\",\"dimensions\":{\"type\":\"Height\",\"min_value\":60,\"max_value\":60,\"unit\":\"feet\"},\"cycle\":\"Perennial\",\"attracts\":[],\"propagation\":[\"Cutting\",\"Grafting Propagation\",\"Layering Propagation\",\"Seed Propagation\",\"Air Layering Propagation\",\"Tissue Culture\"],\"hardiness\":{\"min\":\"7\",\"max\":\"7\"},\"hardiness_location\":{\"full_url\":\"https:\\/\\/perenual.com\\/api\\/hardiness-map?species_id=1&size=og&key=sk-zhTS66a07c67e32476317\",\"full_iframe\":\"<iframe frameborder=0 scrolling=yes seamless=seamless width=1000 height=550 style='margin:auto;' src='https:\\/\\/perenual.com\\/api\\/hardiness-map?species_id=1&size=og&key=sk-zhTS66a07c67e32476317'><\\/iframe>\"},\"watering\":\"Frequent\",\"depth_water_requirement\":[],\"volume_water_requirement\":[],\"watering_period\":null,\"watering_general_benchmark\":{\"value\":\"7-10\",\"unit\":\"days\"},\"plant_anatomy\":[],\"sunlight\":[\"full sun\"],\"pruning_month\":[\"February\",\"March\",\"April\"],\"pruning_count\":[],\"seeds\":0,\"maintenance\":null,\"care-guides\":\"http:\\/\\/perenual.com\\/api\\/species-care-guide-list?species_id=1&key=sk-zhTS66a07c67e32476317\",\"soil\":[],\"growth_rate\":\"High\",\"drought_tolerant\":false,\"salt_tolerant\":false,\"thorny\":false,\"invasive\":false,\"tropical\":false,\"indoor\":false,\"care_level\":\"Medium\",\"pest_susceptibility\":[],\"pest_susceptibility_api\":\"Coming Soon\",\"flowers\":false,\"flowering_season\":null,\"flower_color\":\"\",\"cones\":true,\"fruits\":false,\"edible_fruit\":false,\"edible_fruit_taste_profile\":\"Coming Soon\",\"fruit_nutritional_value\":\"Coming Soon\",\"fruit_color\":[],\"harvest_season\":null,\"leaf\":true,\"leaf_color\":[\"green\"],\"edible_leaf\":false,\"cuisine\":false,\"medicinal\":true,\"poisonous_to_humans\":0,\"poisonous_to_pets\":0,\"description\":\"European Silver Fir (Abies alba) is an amazing coniferous species native to mountainous regions of central Europe and the Balkans. It is an evergreen tree with a narrow, pyramidal shape and long, soft needles. Its bark is scaly grey-brown and its branches are highly ornamental due to its conical-shaped silver-tinged needles. It is pruned for use as an ornamental evergreen hedging and screening plant, and is also popular for use as a Christmas tree. Young trees grow quickly and have strong, flexible branches which makes them perfect for use as windbreaks. The European Silver Fir is an impressive species, making it ideal for gardens and public spaces.\",\"default_image\":{\"license\":45,\"license_name\":\"Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\",\"license_url\":\"https:\\/\\/creativecommons.org\\/licenses\\/by-sa\\/3.0\\/deed.en\",\"original_url\":\"https:\\/\\/perenual.com\\/storage\\/species_image\\/1_abies_alba\\/og\\/1536px-Abies_alba_SkalitC3A9.jpg\",\"regular_url\":\"https:\\/\\/perenual.com\\/storage\\/species_image\\/1_abies_alba\\/regular\\/1536px-Abies_alba_SkalitC3A9.jpg\",\"medium_url\":\"https:\\/\\/perenual.com\\/storage\\/species_image\\/1_abies_alba\\/medium\\/1536px-Abies_alba_SkalitC3A9.jpg\",\"small_url\":\"https:\\/\\/perenual.com\\/storage\\/species_image\\/1_abies_alba\\/small\\/1536px-Abies_alba_SkalitC3A9.jpg\",\"thumbnail\":\"https:\\/\\/perenual.com\\/storage\\/species_image\\/1_abies_alba\\/thumbnail\\/1536px-Abies_alba_SkalitC3A9.jpg\"},\"other_images\":\"Upgrade Plan To Supreme For Access https:\\/\\/perenual.com\\/subscription-api-pricing. Im sorry\"}";

        ObjectMapper mapper = new ObjectMapper();

        JsonNode plantInfo = mapper.readTree(response.body());

        return plantInfo;
    }

    private void displayPlantDetails(Model model, JsonNode plantData, String search) {
            String plantName = plantData.get("common_name").asText();
            String plantImageUrl = plantData.get("default_image").get("original_url").asText();
            model.addAttribute("plantName", plantName);
            model.addAttribute("plantImage", plantImageUrl);
            logger.info(plantName);
            logger.info(plantImageUrl);
    }

    private void addSearchSuggestions(Model model, JsonNode plantList) {

        // TODO complete
    }

    @GetMapping("/plant-wiki")
    public String viewPlantWiki(@RequestParam(name = "search", required = false) String search, Model model) throws IOException, InterruptedException {
        logger.info("GET /plant-wiki with search: " + search);
        model.addAttribute("loggedIn", securityService.isLoggedIn());

        if (search != null && !search.isEmpty()) {
            model.addAttribute("searchTerm", search);
            JsonNode plantList = getPlantListJson(search);
            addSearchSuggestions(model, plantList);

        }





        return "plantWikiPage";
    }

}
